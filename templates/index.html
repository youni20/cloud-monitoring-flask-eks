{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="status-card">
        <h2>System Status</h2>
        <div id="status-indicator" class="status-indicator ok">
            <span id="status-text">Loading...</span>
        </div>
    </div>
    
    <div class="metrics-grid">
        <div class="metric-card">
            <h3>CPU Usage</h3>
            <div class="metric-value">
                <span id="cpu-value">--</span>%
            </div>
            <div class="progress-bar">
                <div id="cpu-progress" class="progress-fill"></div>
            </div>
        </div>
        
        <div class="metric-card">
            <h3>Memory Usage</h3>
            <div class="metric-value">
                <span id="memory-value">--</span>%
            </div>
            <div class="progress-bar">
                <div id="memory-progress" class="progress-fill"></div>
            </div>
        </div>
        
        <div class="metric-card">
            <h3>Disk Usage</h3>
            <div class="metric-value">
                <span id="disk-value">--</span>%
            </div>
            <div class="progress-bar">
                <div id="disk-progress" class="progress-fill"></div>
            </div>
        </div>
    </div>
    
    <div class="alert-section">
        <h3>Alerts</h3>
        <div id="alerts-container">
            <p class="no-alerts">No active alerts</p>
        </div>
    </div>
</div>

<script>
    function updateMetrics() {
        fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                // Update CPU
                document.getElementById('cpu-value').textContent = data.cpu_usage;
                document.getElementById('cpu-progress').style.width = data.cpu_usage + '%';
                
                // Update Memory
                document.getElementById('memory-value').textContent = data.memory_usage;
                document.getElementById('memory-progress').style.width = data.memory_usage + '%';
                
                // Update Disk
                document.getElementById('disk-value').textContent = data.disk_usage;
                document.getElementById('disk-progress').style.width = data.disk_usage + '%';
                
                // Update status
                const statusIndicator = document.getElementById('status-indicator');
                const statusText = document.getElementById('status-text');
                
                if (data.status === 'WARNING') {
                    statusIndicator.className = 'status-indicator warning';
                    statusText.textContent = 'HIGH CPU USAGE DETECTED';
                } else {
                    statusIndicator.className = 'status-indicator ok';
                    statusText.textContent = 'SYSTEM RUNNING NORMALLY';
                }
                
                // Update alerts
                const alertsContainer = document.getElementById('alerts-container');
                if (data.high_cpu_alert) {
                    alertsContainer.innerHTML = `
                        <div class="alert warning">
                            <strong>⚠️ High CPU Usage:</strong> ${data.cpu_usage}% (Threshold: ${data.threshold}%)
                        </div>
                    `;
                } else {
                    alertsContainer.innerHTML = '<p class="no-alerts">No active alerts</p>';
                }
                
                // Color progress bars based on usage
                updateProgressColor('cpu-progress', data.cpu_usage);
                updateProgressColor('memory-progress', data.memory_usage);
                updateProgressColor('disk-progress', data.disk_usage);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('status-text').textContent = 'ERROR FETCHING DATA';
                document.getElementById('status-indicator').className = 'status-indicator error';
            });
    }
    
    function updateProgressColor(elementId, value) {
        const element = document.getElementById(elementId);
        if (value >= 80) {
            element.className = 'progress-fill high';
        } else if (value >= 60) {
            element.className = 'progress-fill medium';
        } else {
            element.className = 'progress-fill low';
        }
    }
    
    // Update metrics every 5 seconds
    updateMetrics();
    setInterval(updateMetrics, 5000);
</script>
{% endblock %}
